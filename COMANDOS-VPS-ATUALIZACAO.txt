================================================================================
üöÄ COMANDOS PARA ATUALIZAR NA VPS - ARK DEPLOY
================================================================================

‚ö° CORRE√á√ÉO AUTOM√ÅTICA (RECOMENDADO)
================================================================================

ssh root@38.242.213.195
cd /opt/ark-deploy
git pull origin main
chmod +x fix-env-vps.sh
./fix-env-vps.sh

# O script faz TUDO:
# ‚úÖ Verifica se .env existe na raiz
# ‚úÖ Copia vari√°veis de backend/.env e frontend/.env.local
# ‚úÖ Corrige NEXT_PUBLIC_API_URL automaticamente
# ‚úÖ Oferece fazer rebuild automaticamente


================================================================================
üìö ENTENDENDO A ESTRUTURA DE .env
================================================================================

COMO FUNCIONA NO DOCKER:

  .env (RAIZ)                    ‚Üê Docker Compose l√™ AQUI
    ‚Üì
  docker-compose.yml
    ‚Üì
  Containers (backend/frontend)  ‚Üê Recebem vari√°veis daqui

ARQUIVOS IGNORADOS PELO DOCKER:
  backend/.env                   ‚Üê Apenas para dev local (npm run dev)
  frontend/.env.local            ‚Üê Apenas para dev local (npm run dev)

PROBLEMA COMUM:
  ‚ùå Voc√™ edita backend/.env
  ‚ùå Docker Compose N√ÉO v√™ essa mudan√ßa
  ‚ùå Containers usam valores padr√£o ou antigos
  ‚ùå Socket.IO conecta em localhost

SOLU√á√ÉO:
  ‚úÖ Editar .env na RAIZ
  ‚úÖ Rebuild dos containers
  ‚úÖ Docker Compose passa valores corretos


================================================================================
üìã PASSO A PASSO MANUAL
================================================================================

1Ô∏è‚É£ CONECTAR NA VPS
-------------------
ssh root@38.242.213.195


2Ô∏è‚É£ IR PARA O DIRET√ìRIO
------------------------
cd /opt/ark-deploy


3Ô∏è‚É£ ATUALIZAR C√ìDIGO DO GITHUB
-------------------------------
git pull origin main


4Ô∏è‚É£ VERIFICAR SE .env EXISTE NA RAIZ
-------------------------------------
ls -la .env

# Se N√ÉO existir, criar:
cp .env.production .env
nano .env
# Verificar se tem: NEXT_PUBLIC_API_URL=http://api.38.242.213.195.sslip.io/api
# Salvar: Ctrl+O, Enter, Ctrl+X


5Ô∏è‚É£ EXECUTAR SCRIPT DE VERIFICA√á√ÉO
-----------------------------------
chmod +x check-env.sh
./check-env.sh

# Este script mostra se est√° tudo configurado corretamente


6Ô∏è‚É£ REBUILD COMPLETO (IMPORTANTE!)
-----------------------------------
docker-compose down
docker-compose build --no-cache
docker-compose up -d


7Ô∏è‚É£ VERIFICAR LOGS
------------------
docker-compose logs -f

# Pressione Ctrl+C para sair quando ver que est√° tudo OK


8Ô∏è‚É£ TESTAR NO NAVEGADOR
------------------------
Abrir: http://painel.38.242.213.195.sslip.io
Abrir Console (F12)
Verificar se N√ÉO tem erro de "localhost:8001"


================================================================================
‚ö†Ô∏è  IMPORTANTE - LEIA ISTO!
================================================================================

NEXT_PUBLIC_API_URL √© uma vari√°vel BUILD-TIME do Next.js

Isso significa:
‚ùå Apenas reiniciar N√ÉO funciona
‚ùå docker-compose restart frontend N√ÉO funciona
‚úÖ √â necess√°rio REBUILD completo do frontend
‚úÖ Use sempre --no-cache para garantir

Por isso o comando correto √©:
docker-compose down
docker-compose build --no-cache
docker-compose up -d


================================================================================
üîç VERIFICAR SE FUNCIONOU
================================================================================

# Ver se containers est√£o rodando
docker-compose ps

# Ver logs do backend
docker-compose logs backend | tail -20

# Ver logs do frontend
docker-compose logs frontend | tail -20

# Verificar se Socket.IO est√° correto (N√ÉO deve ter localhost)
docker-compose logs frontend | grep -i "localhost"

# Se aparecer "localhost:8001", o rebuild n√£o funcionou
# Repita o passo 6


================================================================================
üÜò SE ALGO DER ERRADO
================================================================================

# Parar tudo
docker-compose down

# Limpar cache
docker system prune -a

# Rebuild do zero
docker-compose build --no-cache
docker-compose up -d

# Ver logs em tempo real
docker-compose logs -f


================================================================================
üìö DOCUMENTA√á√ÉO COMPLETA
================================================================================

Criamos 3 novos arquivos de documenta√ß√£o:

1. ENV-SETUP.md - Guia completo sobre vari√°veis de ambiente
2. GUIA-RAPIDO-VPS.md - Guia r√°pido para VPS
3. check-env.sh - Script de diagn√≥stico

Para ler:
cat ENV-SETUP.md
cat GUIA-RAPIDO-VPS.md


================================================================================
‚úÖ CHECKLIST FINAL
================================================================================

[ ] C√≥digo atualizado (git pull)
[ ] Arquivo .env existe na raiz
[ ] NEXT_PUBLIC_API_URL est√° correto no .env
[ ] Rebuild completo foi feito (--no-cache)
[ ] Containers est√£o rodando (docker-compose ps)
[ ] Logs n√£o mostram erros
[ ] Navegador n√£o mostra erro de localhost
[ ] Socket.IO conecta corretamente


================================================================================
üéØ RESUMO DOS COMANDOS (COPIAR E COLAR)
================================================================================

cd /opt/ark-deploy
git pull origin main
chmod +x check-env.sh
./check-env.sh
docker-compose down
docker-compose build --no-cache
docker-compose up -d
docker-compose logs -f


================================================================================
